<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Cart - FABTECH STORE</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='cart.css') }}" />
</head>
<body>

  <h2>Your Shopping Cart</h2>
  <div id="cartItems"></div>
  <div class="total" id="totalAmount"></div>

  <div class="cart-buttons">
    <button class="btn" onclick="purchaseAll()">Purchase All</button>
    <button class="btn btn-danger" onclick="clearCart()">Clear All</button>
    <br /><br />
    <a href="/dashboard" class="btn">← Back to Dashboard</a>
  </div>

  <script>
    function loadCart() {
      const cartItemsDiv = document.getElementById("cartItems");
      const totalAmountDiv = document.getElementById("totalAmount");

      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cartItemsDiv.innerHTML = "";
      let total = 0;

      if (cart.length === 0) {
        cartItemsDiv.innerHTML = "<p>Your cart is empty.</p>";
        totalAmountDiv.textContent = "";
        return;
      }

      cart.forEach((item, index) => {
        total += item.price * item.quantity;

        const itemDiv = document.createElement("div");
        itemDiv.className = "cart-item";

        itemDiv.innerHTML = `
          <img src="${item.image}" alt="${item.name}" width="100" height="100">
          <div class="cart-details">
            <h3>${item.name}</h3>
            <div class="item-info">
              <p><strong>Price:</strong> ₹${item.price}</p>
              <p><strong>Quantity:</strong> ${item.quantity}</p>
            </div>
            <div class="item-actions">
              <button class="btn" onclick="purchaseOne(${index})">Purchase Now</button>
              <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
            </div>
          </div>
        `;

        cartItemsDiv.appendChild(itemDiv);
      });

      totalAmountDiv.innerHTML = `<h3>Total: ₹${total}</h3>`;
    }

    function removeItem(index) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      loadCart();
    }

    function clearCart() {
      if (confirm("Are you sure you want to clear all items?")) {
        localStorage.removeItem("cart");
        loadCart();
        alert("Cart cleared successfully!");
      }
    }

    function purchaseAll() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
      }
      localStorage.setItem("buy-now", JSON.stringify(cart));
      localStorage.removeItem("cart");
      window.location.href = "/successcart";
    }

    function purchaseOne(index) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const item = cart[index];
      if (!item) {
        alert("Item not found.");
        return;
      }
      localStorage.setItem("buy-now", JSON.stringify([item]));
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      window.location.href = "/successcart";
    }

    window.onload = loadCart;
  </script>

</body>
</html>
